# AWS Bedrock RAG - Deployment Architecture

## ğŸ—ï¸ Current Architecture (Network Layer Deployed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ON-PREMISES NETWORK                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  On-Premises DNS Server                                              â”‚  â”‚
â”‚  â”‚  - Conditional Forwarder: aws.internal â†’ 10.10.1.10, 10.10.2.10    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ VPN Tunnel                             â”‚
â”‚                                    â–¼                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS REGION: ap-northeast-2 (Seoul)                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  VPC: vpc-0f759f00e5df658d1 (10.0.0.0/16)                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Public Subnets (3)                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.0.1.0/24 (2a) â”€ NAT GW 1 â”€ IGW                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.0.2.0/24 (2b) â”€ NAT GW 2 â”€ IGW                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ 10.0.3.0/24 (2c) â”€ NAT GW 3 â”€ IGW                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Private Subnets (3)                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.0.11.0/24 (2a) â”€ NAT GW 1 â”€ Internet                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.0.12.0/24 (2b) â”€ NAT GW 2 â”€ Internet                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ 10.0.13.0/24 (2c) â”€ NAT GW 3 â”€ Internet                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  VPN Gateway: vgw-XXXXXXXXX (ASN: 64512)                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Route Propagation: Enabled on Private RTs                  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Route53 Resolver Inbound Endpoint                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ rslvr-in-5b3dfa84cbeb4e66a                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ IPs: 10.10.1.10 (2a), 10.10.2.10 (2b)                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ SG: sg-02892b260ed8b09c4 (DNS 53 TCP/UDP)                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Security Groups:                                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ Lambda SG: sg-XXXXXXXXX                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ OpenSearch SG: sg-XXXXXXXXX                                     â”‚  â”‚
â”‚  â”‚  â””â”€ VPC Endpoints SG: sg-XXXXXXXXX                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ VPC Peering                            â”‚
â”‚                                    â”‚ pcx-06877f7ce046cd122                  â”‚
â”‚                                    â”‚ (10Gbps, DNS enabled Seoulâ†’US)         â”‚
â”‚                                    â–¼                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS REGION: us-east-1 (US East)                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  VPC: vpc-0ed37ff82027c088f (10.1.0.0/16)                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Public Subnets (3)                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.1.1.0/24 (1a) â”€ NAT GW 1 â”€ IGW                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.1.2.0/24 (1b) â”€ NAT GW 2 â”€ IGW                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ 10.1.3.0/24 (1c) â”€ NAT GW 3 â”€ IGW                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Private Subnets (3)                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.1.11.0/24 (1a) â”€ NAT GW 1 â”€ Internet                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ 10.1.12.0/24 (1b) â”€ NAT GW 2 â”€ Internet                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ 10.1.13.0/24 (1c) â”€ NAT GW 3 â”€ Internet                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  VPC Endpoints (To be deployed):                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ Bedrock Runtime (PrivateLink)                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Bedrock Agent Runtime (PrivateLink)                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ S3 Gateway Endpoint                                             â”‚  â”‚
â”‚  â”‚  â””â”€ OpenSearch Serverless (PrivateLink)                             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Security Groups:                                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ Lambda SG: sg-XXXXXXXXX                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ OpenSearch SG: sg-XXXXXXXXX                                     â”‚  â”‚
â”‚  â”‚  â””â”€ VPC Endpoints SG: sg-XXXXXXXXX                                  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  AI/ML Services (To be deployed):                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ OpenSearch Serverless: bos-ai-vectors (2 OCU)                  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Index: bedrock-knowledge-base-index (1536-dim)              â”‚  â”‚
â”‚  â”‚  â”œâ”€ Bedrock KB: bos-ai-knowledge-base                              â”‚  â”‚
â”‚  â”‚  â””â”€ Lambda: document-processor (1024MB, 300s)                       â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Storage (To be deployed):                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ S3: bos-ai-documents-us (Replication target)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ S3: bos-ai-cloudtrail-logs                                     â”‚  â”‚
â”‚  â”‚  â””â”€ SQS: bos-ai-lambda-dlq                                         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Monitoring (To be deployed):                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ CloudWatch Logs (5 groups)                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ CloudWatch Alarms (3)                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ CloudWatch Dashboard                                           â”‚  â”‚
â”‚  â”‚  â””â”€ CloudTrail                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow (To be implemented)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DOCUMENT UPLOAD FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. On-Premises Upload
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User uploads document to Seoul S3 bucket                            â”‚
   â”‚ aws s3 cp document.pdf s3://bos-ai-documents-seoul/documents/      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
2. Cross-Region Replication
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ S3 Seoul â†’ S3 US (Automatic replication)                            â”‚
   â”‚ - Replication role: bos-ai-s3-replication-role-dev                 â”‚
   â”‚ - KMS key: bos-ai-kms-key                                           â”‚
   â”‚ - Latency: ~15 minutes                                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
3. Lambda Trigger
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ S3 Event â†’ Lambda (document-processor)                              â”‚
   â”‚ - Event: s3:ObjectCreated:*                                         â”‚
   â”‚ - VPC: US VPC (10.1.0.0/16)                                         â”‚
   â”‚ - Role: bos-ai-lambda-role-dev                                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
4. Document Processing
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Lambda processes document:                                          â”‚
   â”‚ 1. Read from S3                                                     â”‚
   â”‚ 2. Chunk document (300 tokens, 20% overlap)                         â”‚
   â”‚ 3. Generate embeddings (Bedrock Titan Embed)                        â”‚
   â”‚ 4. Store in OpenSearch                                              â”‚
   â”‚ 5. Update Bedrock KB                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
5. Bedrock Knowledge Base Sync
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Bedrock KB automatically syncs:                                     â”‚
   â”‚ - Data Source: S3 (bos-ai-documents-us)                             â”‚
   â”‚ - Embedding Model: Titan Embed Text v1                              â”‚
   â”‚ - Vector DB: OpenSearch Serverless                                  â”‚
   â”‚ - Status: Visible in CloudWatch logs                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
6. Query Processing
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User queries Bedrock KB:                                            â”‚
   â”‚ 1. Query â†’ Bedrock Agent Runtime                                    â”‚
   â”‚ 2. Retrieve relevant chunks from OpenSearch                         â”‚
   â”‚ 3. Generate response using Claude                                   â”‚
   â”‚ 4. Return RAG result                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SECURITY LAYERS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Network Isolation
â”œâ”€ No Internet Gateway (No-IGW policy)
â”œâ”€ All traffic through NAT Gateway
â”œâ”€ VPC Peering for inter-region communication
â””â”€ Private subnets for all workloads

Layer 2: VPC Endpoints (PrivateLink)
â”œâ”€ Bedrock Runtime (no internet exposure)
â”œâ”€ Bedrock Agent Runtime (no internet exposure)
â”œâ”€ S3 Gateway Endpoint (no internet exposure)
â””â”€ OpenSearch Serverless (no internet exposure)

Layer 3: Security Groups
â”œâ”€ Lambda SG: No inbound, controlled outbound
â”œâ”€ OpenSearch SG: HTTPS 443 from Lambda & Seoul VPC
â””â”€ VPC Endpoints SG: HTTPS 443 from VPC CIDRs

Layer 4: Encryption
â”œâ”€ At Rest: KMS (bos-ai-kms-key)
â”‚  â”œâ”€ S3 buckets
â”‚  â”œâ”€ OpenSearch collections
â”‚  â”œâ”€ CloudWatch logs
â”‚  â””â”€ CloudTrail logs
â”œâ”€ In Transit: TLS 1.2+
â”‚  â”œâ”€ VPC Peering (AWS backbone)
â”‚  â”œâ”€ VPC Endpoints (PrivateLink)
â”‚  â””â”€ Lambda to OpenSearch (HTTPS)
â””â”€ Key Rotation: Annual

Layer 5: IAM (Least Privilege)
â”œâ”€ Bedrock KB Role: S3 read, OpenSearch write, KMS decrypt
â”œâ”€ Lambda Role: S3 read/write, Bedrock invoke, OpenSearch write
â”œâ”€ VPC Flow Logs Role: CloudWatch logs write
â””â”€ S3 Replication Role: S3 read/write, KMS decrypt/encrypt

Layer 6: Audit & Compliance
â”œâ”€ CloudTrail: All API calls logged
â”œâ”€ VPC Flow Logs: Network traffic logged
â”œâ”€ CloudWatch Logs: Application logs
â””â”€ Log Retention: 30 days (configurable)
```

## ğŸ“ˆ Deployment Phases

```
Phase 1: Global Backend âœ… COMPLETED
â”œâ”€ S3 Terraform State Bucket
â”œâ”€ DynamoDB State Lock Table
â””â”€ IAM Policies

Phase 2: Network Layer âœ… COMPLETED
â”œâ”€ Seoul VPC (10.0.0.0/16)
â”œâ”€ US VPC (10.1.0.0/16)
â”œâ”€ VPC Peering
â”œâ”€ Security Groups
â”œâ”€ VPN Gateway
â””â”€ Route53 DNS Integration

Phase 3: App Layer â³ PENDING
â”œâ”€ KMS Encryption
â”œâ”€ IAM Roles & Policies
â”œâ”€ S3 Buckets & Replication
â”œâ”€ Lambda Function
â”œâ”€ OpenSearch Serverless
â”œâ”€ Bedrock Knowledge Base
â”œâ”€ CloudWatch Monitoring
â”œâ”€ CloudTrail Audit
â””â”€ AWS Budgets

Phase 4: Testing & Validation â³ PENDING
â”œâ”€ Property-based tests (47 tests)
â”œâ”€ Unit tests
â”œâ”€ Integration tests
â””â”€ Performance tests
```

## ğŸ¯ Next Steps

1. **Deploy App Layer**
   ```bash
   cd environments/app-layer/bedrock-rag
   terraform init
   terraform plan
   terraform apply
   ```

2. **Configure On-Premises DNS**
   - Add conditional forwarder for aws.internal
   - Point to Route53 Resolver IPs: 10.10.1.10, 10.10.2.10

3. **Test Connectivity**
   - Verify VPC Peering routes
   - Test DNS resolution
   - Validate Lambda VPC connectivity

4. **Run Tests**
   ```bash
   cd tests
   go test -v ./properties/
   go test -v ./unit/
   ```

5. **Monitor & Optimize**
   - Review CloudWatch metrics
   - Adjust Lambda memory/timeout
   - Optimize OpenSearch OCU

